<?PHP
function conectar() {
	require_once("DB.php");
	$dns = "mysql://usuarioBanco:senha@localhost/assembleia";
	$db =& DB::Connect ($dns, array());
	if (PEAR::isError($db)){ die ($db->getMessage()); }
}

function br_data ($dt,$cmp){
	//converte data no formato dd/mm/aaaa para aaaa-mmm-dd e em caso de erro e informado o campo $cmp
				
			$dta = explode("/","$dt");
			$d = $dta[0];
			$m = $dta[1];
			$y = $dta[2];
			$res = checkdate($m,$d,$y);
			if ($res == 1 || $dt=="00/00/0000"){
				$dta="$y-$m-$d";
				return "$dta";
			}else{
				echo "<script> alert('data ou formato inválida! O formato é do tipo: 00/00/0000 (dd/mm/aaaa), Você digitou: $d/$m/$y, para o Campo: $cmp'); window.history.go(-2);</script>";
				echo "data ou formato inválida! O formato é do tipo: 00/00/0000 (dd/mm/aaaa), Você digitou: $d/$m/$y";
				exit;
			}
}

function conv_valor_br ($data) {
		//O exemplo seguinte pega uma data no padrão ISO (AAAA-MM-DD) e retorna valor no formato DD/MM/YYYY
		if (ereg ("([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})", $data, $registros)) {
			$res="$registros[3]/$registros[2]/$registros[1]";
			return $res;
		} else {
			echo "<blink><strong>Formato de data inválido: $data</strong></blink>";
		}
}

function sele_uf ($campo,$valor) {
	//Lista para input select para UF, onde:
	//$campo traz o campo que deve ser alterado e $valor o valor atual do banco
	$sele_uf="<select name='{$campo}' size='1' class='AzulMedio' id='{$campo}' tabindex='1' >".
				"<option value='{$valor}'>{$valor}</option>".
				"<option value='AC'>Acre</option>".
				"<option value='AL'>Alagoas</option>".
				"<option value='AP'>Amapá</option>".
				"<option value='AM'>Amazonas</option>".
				"<option value='BA'>Bahia</option>".
				"<option value='CE'>Ceará</option>".
				"<option value='DF'>Distrito Federal</option>".
				"<option value='GO'>Goiás</option>".
				"<option value='MA'>Maranhão</option>".
				"<option value='MT'>Mato Grosso</option>".
				"<option value='MS'>Mato Grosso do Sul</option>".
				"<option value='MG'>Minas Gerais</option>".
				"<option value='PA'>Pará</option>".
				"<option value='PB'>Paraíba</option>".
				"<option value='PR'>Paraná</option>".
				"<option value='PE'>Pernambuco</option>".
				"<option value='PI'>Piauí</option>".
				"<option value='RJ'>Rio de Janeiro</option>".
				"<option value='RN'>Rio Grande do Norte</option>".
				"<option value='RS'>Rio Grande do Sul</option>".
				"<option value='RO'>Rondônia</option>".
				"<option value='RR'>Roraima</option>".
				"<option value='SC'>Santa Catarina</option>".
				"<option value='SP'>São Paulo</option>".
				"<option value='SE'>Sergipe</option>".
				"<option value='TO'>Tocantins</option>".
			"</select>";
	return $sele_uf;
}


function cargo ($rol) {
	//Devolve o cargo do Membro
	if (isset($rol)){
	
		$opcao = $rol;
		
	}elseif (empty($_SESSION["rol"])){
	
		$opcao = $_POST["rol"];
		
	}else{
	
		$opcao = $_SESSION["rol"];
		
	}
	
	$rec = new DBRecord ("eclesiastico",$opcao,"rol");
	
		if ($rec->pastor()>"0000-00-00") {
			$cargo = "Pastor";
		}elseif ($rec->evangelista()>"0000-00-00") {
			$cargo = "Evangelista";
		}elseif ($rec->presbitero()>"0000-00-00") {
			$cargo = "Presb&iacute;tero";
		}elseif ($rec->diaconato()>"0000-00-00") {
			$cargo = "Di&aacute;cono";
		}elseif ($rec->auxiliar()>"0000-00-00") {
			$cargo = "Auxiliar";
		}elseif (isset($_SESSION["rol"])) {
			$cargo = "Membro";
		}
	unset($_POST["rol"]);
	return $cargo;
}

function cargo_dt () {
	//Devolve a data do ultimo cargo do Membro
	
	$car_dt = new DBRecord ("eclesiastico",$_SESSION["rol"],"rol");
		if ($car_dt->pastor()>"0000-00-00") {
			$cargo_dt = $car_dt->pastor();
		}elseif ($car_dt->evangelista()>"0000-00-00") {
			$cargo_dt = $car_dt->evangelista();
		}elseif ($car_dt->presbitero()>"0000-00-00") {
			$cargo_dt = $car_dt->presbitero();
		}elseif ($car_dt->diaconato()>"0000-00-00") {
			$cargo_dt = $car_dt->diaconato();
		}elseif ($car_dt->auxiliar()>"0000-00-00") {
			$cargo_dt = $car_dt->auxiliar();
		}elseif ($car_dt->dat_aclam()<>"0000-00-00") {
				$cargo_dt = $car_dt->dat_aclam();
			}
	return $cargo_dt;
}

function carta ($id){
	//Devolve o tipo de carta se Apresentação ou Mudança
	
	switch ($id){
		case "1":
			return "de Recomenda&ccedil;&atilde;o";		
			break;
		
		case "2":
			return "de Mudan&ccedil;a";
			break;
		
		case "3":
			return "em Tr&acirc;nsito";
			break;
		
		default:
			return "N&atilde;o Definida no Banco";
			break;
	}		
}

function mostra_foto () {
	//Mostra a foto do membro
	if (!empty($_SESSION["rol"])){
	
		 if (file_exists("../img_membros/".$_SESSION["rol"].".jpg")){
				$img="../img_membros/".$_SESSION["rol"].".jpg";
			}elseif (file_exists("img_membros/".$_SESSION["rol"].".jpg")){
				$img="img_membros/".$_SESSION["rol"].".jpg";
			}elseif (file_exists("img_membros/ver_foto.jpg")){
				$img="img_membros/ver_foto.jpg";
			}else{
				$img="../img_membros/ver_foto.jpg";
			}
		return "<img src='$img' width='75' height='98' border='1' align='absmiddle' />";
	}
}

function data_venc($data){
	//acrescenta 30 dias apartir da data fornecida
	if (isset ($data)){
		$dta = explode("/",$data);
		$d=$dta[0];
		$m=$dta[1];
		$y=$dta[2];
		$res = checkdate($m,$d,$y);
		if ($res == 1 ){
			return date("d/m/Y",(mktime(0, 1, 0, $m, $d+30, $y)));
			}else{
				echo "<script> alert('data ou formato inválida! O formato é do tipo: 00/00/0000 (dd/mm/aaaa), Você digitou: $d/$m/$y');</script>";
				echo "data ou formato inválida! O formato é do tipo: 00/00/0000 (dd/mm/aaaa), Você digitou: $d/$m/$y";
				break;
			}
	}else{
		echo "<script> alert('Data não informada!');</script>";
		echo "<h1> Data não informada! </h1>";

	}
}

function fun_igreja ($rol){
	//retorno o nome do membro de acordo com o rol
	$membro = new DBRecord ("membro",$rol,"rol");
	return  $membro->nome();
}


function validaCPF($cpf) {
	$soma = 0;
	
	//verifica se cpf tem um formato valido (000.000.000-00)
	if (ereg("^([0-9]){3}.([0-9]){3}.([0-9]){3}-([0-9]){2}",$cpf)){
		//echo "<script> alert('CPF formato Verdadeiro!');</script>";

		$cpf = str_replace(array(".","-"), "", $cpf);//remove caracteres para tratar a string como número
	
		
		if (strlen($cpf) <> 11 || ($cpf == '11111111111') || ($cpf == '22222222222') ||
			($cpf == '33333333333') || ($cpf == '44444444444') ||
			($cpf == '55555555555') || ($cpf == '66666666666') ||
			($cpf == '77777777777') || ($cpf == '88888888888') ||
			($cpf == '99999999999') || ($cpf == '00000000000'))
			return false;
		
		// Verifica 1º digito		
		for ($i = 0; $i < 9; $i++) {			
			$soma += (($i+1) * $cpf[$i]);
		}
	
		$d1 = ($soma % 11);
		
		if ($d1 == 10) {
			$d1 = 0;
		}
		
		$soma = 0;
		
		// Verifica 2º digito
		for ($i = 9, $j = 0; $i > 0; $i--, $j++) {
			$soma += ($i * $cpf[$j]);
		}
		
		$d2 = ($soma % 11);
		
		if ($d2 == 10) {
			$d2 = 0;
		}		
		
		if ($d1 == $cpf[9] && $d2 == $cpf[10]) {
			return true;
		}
		else {
			return false;
		}
	
	}elseif ($_POST["submit"]=="Alterar CPF ..."){
		echo "<script> alert('CPF com formato INVÁLIDO!');</script>";
	}
	
}
	
	
	
	
	
// VERFICA CNPJ
function validaCNPJ($cnpj) {

	if (strlen($cnpj) <> 14)
		return false; 

	$soma = 0;
	
	$soma += ($cnpj[0] * 5);
	$soma += ($cnpj[1] * 4);
	$soma += ($cnpj[2] * 3);
	$soma += ($cnpj[3] * 2);
	$soma += ($cnpj[4] * 9); 
	$soma += ($cnpj[5] * 8);
	$soma += ($cnpj[6] * 7);
	$soma += ($cnpj[7] * 6);
	$soma += ($cnpj[8] * 5);
	$soma += ($cnpj[9] * 4);
	$soma += ($cnpj[10] * 3);
	$soma += ($cnpj[11] * 2); 

	$d1 = $soma % 11; 
	$d1 = $d1 < 2 ? 0 : 11 - $d1; 

	$soma = 0;
	$soma += ($cnpj[0] * 6); 
	$soma += ($cnpj[1] * 5);
	$soma += ($cnpj[2] * 4);
	$soma += ($cnpj[3] * 3);
	$soma += ($cnpj[4] * 2);
	$soma += ($cnpj[5] * 9);
	$soma += ($cnpj[6] * 8);
	$soma += ($cnpj[7] * 7);
	$soma += ($cnpj[8] * 6);
	$soma += ($cnpj[9] * 5);
	$soma += ($cnpj[10] * 4);
	$soma += ($cnpj[11] * 3);
	$soma += ($cnpj[12] * 2); 
	
	
	$d2 = $soma % 11; 
	$d2 = $d2 < 2 ? 0 : 11 - $d2; 
	
	if ($cnpj[12] == $d1 && $cnpj[13] == $d2) {
		return true;
	}
	else {
		return false;
	}
} 

function link_corrent ($link) {
	//
	if ($link=="top_dados") {
		echo "class='selected'";
	}elseif ($_GET["menu"]==$link) {
		echo "class='selected'";
	}
}

function id_corrente ($val_link) {
	/*	Define se este botão ou limk é o corrente e o define para tal com mudança
	*	da cor de fundo. Isto deve ser definido no script de CSS
	*/
	if ((strstr($_GET["escolha"], $val_link) || strstr($_POST["escolha"],$val_link))) {
		echo "id='current'";
	}
}

function id_left ($val_link) {
	/*	Define se este botão ou limk é o corrente e o define para tal com mudança
	*	da cor de fundo. Isto deve ser definido no script de CSS
	*/
	if ((strstr($_GET["escolha"], $val_link) || strstr($_POST["escolha"],$val_link))) {
		echo "class='selected'";
		//return "teste";
	}
}

function sim_nao ($sn) {
	if ($sn==1) {
		return "Sim";
	}else {
		return "N&atilde;o";
	}
}

function sit_espiritual ($se) {
		  switch ($se){
		  	case "1":
				return "Em Comunh&atilde;o"; break;
			case "2":
				return "Disciplinado"; break;
			default:
				return "Situa&ccedil;&atilde;o n&atilde;o definida!"; break;
		  }
}

function sexo ($sexo) {
	if (strtoupper($sexo)=="F"){
		return "feminino";
	}elseif (strtoupper($sexo)=="M"){
		return "masculino";
	}else {
		return "N&atilde;o Informado";
	}
}

function a_ou_o ($sexo) {
	if ($sexo=="F"){
		return "a";
	}elseif ($sexo=="M"){
		return "o";
	}else {
		return "N&atilde;o Informado";
	}
}

function data_extenso ($data) {
	//Fluxo para atribuir nome por extenso do dia e mês na impressão para o período
	$dta = explode("/","$data");
			$d = $dta[0];
			$m = $dta[1];
			$y = $dta[2];
			$ver_data = checkdate($m,$d,$y);
			
	if (!$ver_data){
				echo "<script> alert('data ou formato inválida! O formato é do tipo: 00/00/0000 (dd/mm/aaaa), Você digitou: $d/$m/$y'); window.history.go(-2);</script>";
				echo "data ou formato inválida! O formato é do tipo: 00/00/0000 (dd/mm/aaaa), Você digitou: $d/$m/$y";
				break;
			}

	$dia=date("w",$data);
	switch	($dia){
		case 1: $dia_extenso="Domingo";
				break;
		case 2: $dia_extenso="Segunda-feira";
				break;
		case 3: $dia_extenso="Ter&ccedil;a-feira";
				break;
		case 4: $dia_extenso="Quarta-feira";
				break;
		case 5: $dia_extenso="Quinta-feira";
				break;
		case 6: $dia_extenso="Sexta-feira";
				break;
		case 7: $dia_extenso="Sabado";
				break;
		default: echo $dia_extenso="Dia incorreto";
	}//fim do case para o dia
	
	switch	($m){
		case 1: $mes_extenso="Janeiro";
				break;
		case 2: $mes_extenso="Fevereiro";
				break;
		case 3: $mes_extenso="Março";
				break;
		case 4: $mes_extenso="Abril";
				break;
		case 5: $mes_extenso="Maio";
				break;
		case 6: $mes_extenso="Junho";
				break;
		case 7: $mes_extenso="Julho";
				break;
		case 8: $mes_extenso="Agosto";
				break;
		case 9: $mes_extenso="Setembro";
				break;
		case 10: $mes_extenso="Outubro";
				break;
		case 11: $mes_extenso="Novembro";
				break;
		case 12: $mes_extenso="Dezembro";
				break;
		default: echo $mes_extenso="Mês incorreto";
	}//fim do case para o mês
	
	return $dia_extenso.", ".$d." de ".$mes_extenso." de ".$y.".";
}

function controle ($tipo){ //O tipo é definido como consulta, atualização, inserir, administração de usuário
	
	$alerta = "<script> alert('Desculpe mas você não tem autorização para $tipo!');location.href='./';</script>";
	switch ($tipo) {
		case "consulta":
			if ($_SESSION["nivel"]<5){
				echo $alerta;
				return exit;
			}
			break;
		case "atualizar":
			if ($_SESSION["nivel"]<7){
				echo $alerta;
				return exit;
			}
			break;
		case "inserir":
			if ($_SESSION["nivel"]<8){
				echo $alerta;
				return exit;
			}
			break;
		case "admin_user":
			if ($_SESSION["nivel"]<9){
				echo $alerta;
				return exit;
			}
			break;
		default:
			echo $alerta;
			return exit;
			break;	
		
	}
}

function ver_cad (){
	//Verifica se o rol selecionado tem cadastro
	$ver_cadastro = new DBRecord ("membro",$_SESSION['rol'],"rol"); //Aqui será selecionado a informação do campo
	if ($ver_cadastro->rol()=="") {
	echo "<h3>N&atilde;o h&aacute; cadastro para o Rol: {$_SESSION["rol"]}.</h3>";
	unset ($_SESSION["rol"]);
	exit;
	}
}

function form_preenchido($form_vars)
	{
		//Testa se cada variável tem um valor
	  foreach ($form_vars as $key => $value)
	  {
		 if (!isset($key) || ($value == '')) 
			return false;
	  } 
	  return true;
		
	}
	
function situacao ($situacao){

	switch ($situacao)
	{
		case "1":
			$estilo="";
			break;
		case "2":
			$estilo="<span style='color:#FF0000'><blink>Ver comunh&atilde;o</blink></span>";
			
			$result = mysql_query("SELECT DATE_FORMAT(data_fim,'%d/%m/%Y') AS dt_fim FROM disciplina WHERE rol = '{$_SESSION["rol"]}' ORDER BY id DESC LIMIT 1");
			
			$data = mysql_fetch_array($result);
			
			$data_fim = " - Displinado até: ".$data ["dt_fim"];
						
			break;
		case "3":
			$estilo="<h1><span style='color:#FF0000'><blink>Falecido</blink></span></h1>";
			break;
		case "4":
			$estilo="<span style='color:#FF0000'><blink>Mudou de Igreja</blink></span>";
			break;
		case "5":
			$estilo="<span style='color:#FF0000'><blink>Afastou-se</blink></span>";
			break;
		default:

			$estilo="<span style='color:#006633'><blink>Corrija a comunh&atilde;o com a Igreja. Use bot&atilde;o Eclesi&aacute;stico acima!</blink></span>";
			break;
						
	}
	
	return $estilo.$data_fim ;
	}	
?>
